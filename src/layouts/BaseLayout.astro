---
/**
 * BaseLayout.astro
 * Layout base reutilizable con AOS, SEO avanzado y Schema.org
 */

import { site, schemaOrg } from '../data/config.js';

interface Props {
  title?: string;
  description?: string;
  keywords?: string;
  ogImage?: string;
  canonicalURL?: string;
  type?: 'website' | 'article' | 'profile';
}

const {
  title,
  description = site.seo.defaultDescription,
  keywords = site.seo.keywords,
  ogImage = site.seo.ogImage,
  canonicalURL = Astro.url.href,
  type = site.seo.type,
} = Astro.props;

// Construir título completo
const fullTitle = title 
  ? site.seo.titleTemplate.replace('%s', title)
  : site.seo.defaultTitle;

const siteUrl = Astro.site || 'https://benjamin-mardones.cl';
---

<!doctype html>
<html lang="es" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="generator" content={Astro.generator} />
    
    <!-- Google Fonts: Playfair Display + Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- 🎯 SEO Meta Tags -->
    <title>{fullTitle}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="author" content={site.business.name} />
    <link rel="canonical" href={canonicalURL} />
    
    <!-- 🌍 Localización y Geo-targeting -->
    <meta name="geo.region" content="CL-AR" />
    <meta name="geo.placename" content="Temuco" />
    <meta name="geo.position" content={`${site.business.geo.latitude};${site.business.geo.longitude}`} />
    <meta name="ICBM" content={`${site.business.geo.latitude}, ${site.business.geo.longitude}`} />
    
    <!-- 🤖 Robots -->
    <meta name="robots" content="index, follow, max-image-preview:large" />
    
    <!-- 📱 Open Graph mejorado -->
    <meta property="og:type" content={type} />
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={`${siteUrl}${ogImage}`} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:locale" content={site.seo.locale} />
    <meta property="og:site_name" content={site.business.name} />
    
    <!-- 🐦 Twitter Card -->
    <meta name="twitter:card" content={site.seo.twitterCard} />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={fullTitle} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={`${siteUrl}${ogImage}`} />
    
    <!-- 🎨 Theme Color -->
    <meta name="theme-color" content={site.theme.colors.brand?.DEFAULT || '#1A1A1A'} />
    
    <!-- 🔗 Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    
    <!-- 📊 Schema.org JSON-LD -->
    <script type="application/ld+json" set:html={JSON.stringify(schemaOrg)} />
    
    <!-- 🎞️ AOS CSS -->
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css" />
  </head>
  
  <body class="font-sans antialiased bg-gradient-to-b from-neutral-900 via-black to-neutral-950 text-white selection:bg-yellow-600 selection:text-black">
    <slot />
    
    <!-- 🎞️ AOS JavaScript -->
    <script is:inline src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script is:inline>
      AOS.init({
        duration: 600,
        easing: 'ease-out',
        once: true,
        offset: 50,
        delay: 0,
      });
    </script>
  </body>
</html>

<style is:global>
  /* 🎨 Estilos globales optimizados */
  
  html {
    scroll-behavior: smooth;
    scroll-padding-top: 80px;
  }
  
  body {
    overflow-x: hidden;
  }

  /* 📱 Container responsive con padding mejorado para móviles pequeños */
  .container-custom {
    width: 100%;
    margin-left: auto;
    margin-right: auto;
    padding-left: 1rem;  /* 16px */
    padding-right: 1rem;
  }
  
  @media (min-width: 375px) {
    .container-custom {
      padding-left: 1.25rem;  /* 20px */
      padding-right: 1.25rem;
    }
  }
  
  @media (min-width: 640px) {
    .container-custom {
      padding-left: 2rem;  /* 32px */
      padding-right: 2rem;
      max-width: 640px;
    }
  }
  
  @media (min-width: 768px) {
    .container-custom {
      max-width: 768px;
    }
  }
  
  @media (min-width: 1024px) {
    .container-custom {
      max-width: 1024px;
      padding-left: 2.5rem;  /* 40px */
      padding-right: 2.5rem;
    }
  }
  
  @media (min-width: 1280px) {
    .container-custom {
      max-width: 1280px;
    }
  }

  /* 🎯 Accesibilidad */
  *:focus-visible {
    outline: 2px solid var(--color-brand, #2563eb);
    outline-offset: 2px;
    border-radius: 2px;
  }

  /* 🎬 Animaciones con IntersectionObserver para performance */
  [data-animate] {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }
  
  [data-animate].animated {
    opacity: 1;
    transform: translateY(0);
  }

  /* 🎨 Utilidades personalizadas para micro-interacciones */
  .hover-lift {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  .hover-lift:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }
  
  .btn-primary {
    @apply bg-brand text-white px-6 py-3.5 rounded-lg font-semibold 
           hover:bg-brand-700 hover:shadow-brand transition-all duration-300 
           hover:scale-105 active:scale-95
           min-h-[44px] text-center inline-flex items-center justify-center;
  }
  
  .btn-secondary {
    @apply bg-accent text-white px-6 py-3.5 rounded-lg font-semibold 
           hover:bg-accent-600 hover:shadow-accent transition-all duration-300 
           hover:scale-105 active:scale-95
           min-h-[44px] text-center inline-flex items-center justify-center;
  }
  
  /* 📸 Skeleton loading para imágenes */
  img[loading="lazy"] {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s ease-in-out infinite;
  }
  
  @keyframes loading {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }
  
  /* 🎯 Mejora de imágenes con aspect-ratio */
  img {
    max-width: 100%;
    height: auto;
    display: block;
  }
  
  /* ✨ Texto con gradiente para títulos destacados */
  .text-gradient {
    background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  /* 🌊 Efectos de backdrop blur para glassmorphism */
  .glass {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  
  .glass-dark {
    background: rgba(15, 23, 42, 0.8);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  
  /* 🎯 Animación pulse para CTAs */
  @keyframes pulse {
    0%, 100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
  }
  
  .animate-pulse-btn {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
  
  /* 🎨 Animación de ondas para fondos */
  @keyframes wave {
    0%, 100% {
      transform: translateY(0) translateX(0) rotate(0deg);
    }
    25% {
      transform: translateY(-20px) translateX(10px) rotate(2deg);
    }
    50% {
      transform: translateY(0) translateX(20px) rotate(0deg);
    }
    75% {
      transform: translateY(20px) translateX(10px) rotate(-2deg);
    }
  }
  
  .animate-wave {
    animation: wave 20s ease-in-out infinite;
  }
</style>

<script>
  // 🎬 IntersectionObserver + AOS trabajan juntos
  // Mantén data-animate para compatibilidad con código existente
  document.addEventListener('DOMContentLoaded', () => {
    const animateElements = document.querySelectorAll('[data-animate]:not([data-aos])');
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animated');
          observer.unobserve(entry.target);
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    });
    
    animateElements.forEach(el => observer.observe(el));
  });
</script>
